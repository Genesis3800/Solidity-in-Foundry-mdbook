<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>VRF.sol - Solidity in Foundry</title>


        <!-- Custom HTML head -->
                <meta name="twitter:card" content="summary">
                <meta property="og:title" content="Solidity in Foundry" />
                <meta property="og:description" content="Learn Solidity from scratch using Foundry" />
                <meta name="twitter:image" content="https://raw.githubusercontent.com/Genesis3800/Solidity-in-Foundry-mdbook/main/theme/Solidity-in-Foundry-LinkPreview200.png" />
                <meta property="og:image" content="https://raw.githubusercontent.com/Genesis3800/Solidity-in-Foundry-mdbook/main/theme/Solidity-in-Foundry-LinkPreview200.png" />
        
                <!-- Google tag (gtag.js) -->
                <script async src="https://www.googletagmanager.com/gtag/js?id=G-QSB0XQQM7F"></script>
                <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-QSB0XQQM7F');
                </script>
        <meta name="description" content="Learn Solidity from scratch using Foundry">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../../index.html">About</a></li><li class="chapter-item expanded affix "><a href="../../../GettingStarted.html">Getting Started</a></li><li class="chapter-item expanded affix "><li class="part-title">Solidity/Foundry Basics</li><li class="chapter-item expanded "><a href="../../../SolidityBasics/HelloWorld/HelloWorld.html"><strong aria-hidden="true">1.</strong> Hello World</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../SolidityBasics/HelloWorld/HelloWorld_contract.html"><strong aria-hidden="true">1.1.</strong> HelloWorld.sol</a></li><li class="chapter-item "><a href="../../../SolidityBasics/HelloWorld/HelloWorld_test.html"><strong aria-hidden="true">1.2.</strong> HelloWorld.t.sol</a></li></ol></li><li class="chapter-item expanded "><a href="../../../SolidityBasics/TypesInSolidity/TypesInSolidity.html"><strong aria-hidden="true">2.</strong> Types in Solidity</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../SolidityBasics/TypesInSolidity/ValueTypes.html"><strong aria-hidden="true">2.1.</strong> Value Types</a></li><li class="chapter-item "><a href="../../../SolidityBasics/TypesInSolidity/ReferenceTypes.html"><strong aria-hidden="true">2.2.</strong> Reference Types</a></li></ol></li><li class="chapter-item expanded "><a href="../../../SolidityBasics/Visibility/Visibility.html"><strong aria-hidden="true">3.</strong> Visibility</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../SolidityBasics/Visibility/Visibility_contract.html"><strong aria-hidden="true">3.1.</strong> Visibility.sol</a></li><li class="chapter-item "><a href="../../../SolidityBasics/Visibility/Visibility_test.html"><strong aria-hidden="true">3.2.</strong> Visibility.t.sol</a></li></ol></li><li class="chapter-item expanded "><a href="../../../SolidityBasics/VariableScoping/VariableScoping.html"><strong aria-hidden="true">4.</strong> Variable scopes in Solidity</a></li><li class="chapter-item expanded "><a href="../../../SolidityBasics/Interfaces/Interfaces.html"><strong aria-hidden="true">5.</strong> Interface</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../SolidityBasics/Interfaces/Interfaces_SimpleAddition_contract.html"><strong aria-hidden="true">5.1.</strong> SimpleAddition.sol</a></li><li class="chapter-item "><a href="../../../SolidityBasics/Interfaces/Interfaces_SimpleAddition_Interface.html"><strong aria-hidden="true">5.2.</strong> Interface_SimpleAddition.sol</a></li><li class="chapter-item "><a href="../../../SolidityBasics/Interfaces/Interfaces_contract.html"><strong aria-hidden="true">5.3.</strong> UsingInterface.sol</a></li><li class="chapter-item "><a href="../../../SolidityBasics/Interfaces/Interfaces_test.html"><strong aria-hidden="true">5.4.</strong> Interfaces.t.sol</a></li></ol></li><li class="chapter-item expanded "><a href="../../../SolidityBasics/Library/Library.html"><strong aria-hidden="true">6.</strong> Libraries</a></li><li class="chapter-item expanded affix "><li class="part-title">Tutorials</li><li class="chapter-item expanded "><a href="../../../Applications/Chainlink/Chainlink.html"><strong aria-hidden="true">7.</strong> Chainlink</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../Applications/Chainlink/ChainlinkDataFeeds/ChainlinkDataFeeds.html"><strong aria-hidden="true">7.1.</strong> Chainlink Data Feeds</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../Applications/Chainlink/ChainlinkDataFeeds/ChainlinkDataFeeds_contract.html"><strong aria-hidden="true">7.1.1.</strong> DataFeeds.sol</a></li><li class="chapter-item "><a href="../../../Applications/Chainlink/ChainlinkDataFeeds/ChainlinkDatafeeds_test.html"><strong aria-hidden="true">7.1.2.</strong> DataFeeds.t.sol</a></li><li class="chapter-item "><a href="../../../Applications/Chainlink/ChainlinkDataFeeds/ChainlinkDataFeeds_deploy.html"><strong aria-hidden="true">7.1.3.</strong> DataFeeds.s.sol</a></li></ol></li><li class="chapter-item expanded "><a href="../../../Applications/Chainlink/ChainlinkVRF/ChainlinkVRF.html"><strong aria-hidden="true">7.2.</strong> Chainlink VRF</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../Applications/Chainlink/ChainlinkVRF/ChainlinkVRF_contract.html" class="active"><strong aria-hidden="true">7.2.1.</strong> VRF.sol</a></li><li class="chapter-item "><a href="../../../Applications/Chainlink/ChainlinkVRF/ChainlinkVRF_test.html"><strong aria-hidden="true">7.2.2.</strong> VRF.t.sol</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../../Applications/LayerZero/LayerZero.html"><strong aria-hidden="true">8.</strong> Layer Zero</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../Applications/LayerZero/lzMockEndpoint/lzMockEndpoint.html"><strong aria-hidden="true">8.1.</strong> Using a mock LZ endpoint</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../Applications/LayerZero/lzMockEndpoint/LayerZero_contract.html"><strong aria-hidden="true">8.1.1.</strong> LayerZero.sol</a></li><li class="chapter-item "><a href="../../../Applications/LayerZero/lzMockEndpoint/LayerZero_test.html"><strong aria-hidden="true">8.1.2.</strong> LayerZero.t.sol</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Solidity in Foundry</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Genesis3800/Solidity-in-Foundry-mdbook" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="chainlinkvrfsol"><a class="header" href="#chainlinkvrfsol">ChainlinkVRF.sol</a></h1>
<blockquote>
<p>💻 The code corresponding to this page can be found on Github at <a href="https://github.com/Genesis3800/Solidity-in-Foundry-Repo/blob/main/src/Applications/Chainlink/ChainlinkVRF/ChainlinkVRF.sol">ChainlinkVRF.sol</a> 💻</p>
</blockquote>
<h2 id="creating-a-vrf-subscription"><a class="header" href="#creating-a-vrf-subscription">Creating a VRF subscription</a></h2>
<p>Unlike the price feeds service, Chainlink VRF is not free to use.
Each randomness request costs a certain amount of LINK tokens.</p>
<p>There are two ways to pay for a VRF request:</p>
<ol>
<li><strong>Direct Funding:</strong> Your smart contract directly pays a small amount of LINK tokens with each request.</li>
<li><strong>Subscription Method:</strong> You fund a single subscription with LINK tokens, and add your smart contracts as approved consumers of that subscription. Each time your smart contract makes a randomness request, the subscription is charged a small amount of LINK tokens.</li>
</ol>
<p>We will be using the subscription method in this tutorial.</p>
<p>These are the steps to set up a VRF subscription:</p>
<ol>
<li>Make sure you have some LINK tokens in an EOA. You can get a few from <a href="https://faucets.chain.link/">Chainlink's faucet</a>.</li>
<li>Go to <a href="https://vrf.chain.link/">vrf.chain.link</a> and create a new subscription. I will be working with the Sepolia testnet.</li>
<li>Fund your subscription with some LINK tokens(50 should be more than enough).</li>
</ol>
<p>We are now ready to start writing our smart contract.</p>
<h2 id="writing-the-smart-contract"><a class="header" href="#writing-the-smart-contract">Writing the smart contract</a></h2>
<p>To get started, create a new file called <code>ChainlinkVRF.sol</code> inside your Foundry project.</p>
<p>We need to import two things into our contract:</p>
<ol>
<li><code>VRFCoordinatorV2Interface</code>: Each network supported by Chainlink has an on-chain coordinator contract that handles all VRF requests. use this interface to interact with the coordinator contract.</li>
<li><code>VRFConsumerBaseV2</code>: This is an abstract contract, which means this is an incomplete contract with at least one of its functions left unimplemented. We will inherit from this contract and implement the missing function, <code>fulfillRandomWords()</code>.</li>
</ol>
<pre><code class="language-solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

import &quot;@chainlink/v0.8/interfaces/VRFCoordinatorV2Interface.sol&quot;;
import &quot;@chainlink/v0.8/VRFConsumerBaseV2.sol&quot;;
</code></pre>
<p>Next, let us initialize a contract named <code>ChainlinkVRF</code>:</p>
<pre><code class="language-solidity">contract ChainlinkVRF is VRFConsumerBaseV2 {

}
</code></pre>
<p>To send a randomness request to Chainlink VRF, we need to configure a few variables. Let us take a look:</p>
<ul>
<li><code>keyHash</code>: Each <code>keyHash</code> is a hexadecimal value that represents a '<em>gas lane</em>'. Each gas lane costs a different amount of gas.</li>
<li><code>subId</code>: The subscription ID of the subscription we created earlier.</li>
<li><code>minimumRequestConfirmations</code>: The number of blocks you would like the off-chain node to wait before fulfilling your request. The higher this number, the more secure your randomness will be.</li>
<li><code>callbackGasLimit</code>: How much gas would you like to be used on your callback function.</li>
<li><code>numWords</code>: The number of <code>uint256</code> values you would like to receive. We will be requesting 1 word.</li>
</ul>
<blockquote>
<p>📝  <strong>Note:</strong>
All of these values will differ depending on the network you are working with. You can find the technical reference for all supported
networks <a href="https://docs.chain.link/vrf/v2/subscription/supported-networks">here</a>.</p>
</blockquote>
<p>Let us configure these variables:</p>
<pre><code class="language-solidity">    VRFCoordinatorV2Interface private CoordinatorInterface;
    uint64 private _subscriptionId;
    bytes32 private constant KEY_HASH = 0x474e34a077df58807dbe9c96d3c009b23b3c6d0cce433e59bbf5b34f823bc56c;
    uint32 private constant CALLBACK_GAS_LIMIT = 100000;
    uint16 private constant BLOCK_CONFIRMATIONS = 10;
    uint32 private constant NUM_WORDS = 1;

    // Variable to store the generated random number
    uint256 public number;
</code></pre>
<p>The <code>CoordinatorInterface</code> and <code>_subscriptionId</code> variables will be initialized in the constructor.
The <code>number</code> variable will store the generated random number.</p>
<p>The constructor can be initialized as follows:</p>
<pre><code class="language-solidity">    constructor(uint64 subscriptionId, address vrfCoordinatorV2Address) VRFConsumerBaseV2(vrfCoordinatorV2Address) {
        _subscriptionId = subscriptionId;
        CoordinatorInterface = VRFCoordinatorV2Interface(vrfCoordinatorV2Address);
    }

</code></pre>
<p>Let us now define a function named <code>useChainlinkVRF()</code> that will send a randomness request to the Chainlink VRF coordinator contract.
This function will send a randomness request to the coordinator contract, and return a <code>requestId</code> that will be used to identify the request.</p>
<pre><code class="language-solidity">     function useChainlinkVRF() public returns (uint256 requestId) {
        requestId = CoordinatorInterface.requestRandomWords(
            KEY_HASH,
            _subscriptionId,
            BLOCK_CONFIRMATIONS,
            CALLBACK_GAS_LIMIT,
            NUM_WORDS
        );
        return requestId;
    }
</code></pre>
<p>Lastly, we need to define the <code>fulfillRandomWords()</code> function. This function will be called by the Chainlink VRF coordinator contract once the randomness request has been fulfilled by the off-chain Chainlink node.</p>
<p>We can modulo the huge random number we get back to trim it down to a desired range.
Based on the number we get back, we will set the <code>number</code> variable to 1, 2, or 3.</p>
<pre><code class="language-solidity">    function fulfillRandomWords(uint256 requestId, uint256[] memory randomWords) internal override {

        // To get a random number b/w 1 and 100 inclusive
        uint256 randomNumber = (randomWords[0] % 100) + 1;

        if(randomNumber == 100){
            number = 1;
        } else if(randomNumber % 3 == 0) {
            number = 2;
        } else {
            number = 3;
        }
    }
</code></pre>
<p>And that's it for now.
By calling the <code>useChainlinkVRF()</code> function on our contract, a user can get back a random number b/w 1 and 3 with a varying degree of probability.</p>
<p>In the next section, we will use the <code>VRFCoordinatorV2Mock</code> to write a preliminary test for our VRF contract.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../Applications/Chainlink/ChainlinkVRF/ChainlinkVRF.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../../Applications/Chainlink/ChainlinkVRF/ChainlinkVRF_test.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../Applications/Chainlink/ChainlinkVRF/ChainlinkVRF.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../../Applications/Chainlink/ChainlinkVRF/ChainlinkVRF_test.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../src/static/solidity.min.js"></script>


    </div>
    </body>
</html>
